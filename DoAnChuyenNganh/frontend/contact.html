<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liên hệ - Laptop World</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="header-container"></div>

    <section class="py-4">
        <div class="container">
            <div class="row mb-5">
                <div class="col-md-4 mb-4">
                    <div class="card h-100 text-center">
                        <div class="card-body p-4">
                            <div class="mb-3">
                                <i class="fas fa-map-marker-alt fa-3x text-primary"></i>
                            </div>
                            <h5>Địa chỉ</h5>
                            <p class="text-muted">Xã Càng Long<br>Tỉnh Vĩnh Long, Việt Nam</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-4">
                    <div class="card h-100 text-center">
                        <div class="card-body p-4">
                            <div class="mb-3">
                                <i class="fas fa-phone fa-3x text-primary"></i>
                            </div>
                            <h5>Điện thoại</h5>
                            <p class="text-muted">Hotline: 0394 127 625<br>Hỗ trợ: 0989 12 18 14</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-4">
                    <div class="card h-100 text-center">
                        <div class="card-body p-4">
                            <div class="mb-3">
                                <i class="fas fa-envelope fa-3x text-primary"></i>
                            </div>
                            <h5>Email</h5>
                            <p class="text-muted">nhattruong.261097@gmail.com</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="card">
                        <div class="card-body p-4">
                            <h4 class="card-title mb-4">Gửi tin nhắn cho chúng tôi</h4>

                            <form id="contactForm" onsubmit="handleContact(event)">
                                <div class="mb-3">
                                    <label class="form-label">Họ và tên *</label>
                                    <input type="text" class="form-control" id="contactName" required>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Email *</label>
                                        <input type="email" class="form-control" id="contactEmail" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Số điện thoại</label>
                                        <input type="tel" class="form-control" id="contactPhone">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Chủ đề *</label>
                                    <select class="form-select" id="contactSubject" required>
                                        <option value="">Chọn chủ đề...</option>
                                        <option>Tư vấn sản phẩm</option>
                                        <option>Hỗ trợ kỹ thuật</option>
                                        <option>Khiếu nại</option>
                                        <option>Góp ý</option>
                                        <option>Khác</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Nội dung * <span class="text-muted small">(Tối đa 100 từ)</span></label>
                                    <textarea class="form-control" id="contactMessage" rows="5" required
                                        placeholder="Nhập nội dung tin nhắn..." oninput="countWords(this)"></textarea>
                                    <div class="form-text">
                                        <span id="wordCount">0</span>/100 từ
                                        <span id="wordCountWarning" class="text-danger ms-2" style="display:none;">⚠️ Vượt quá giới hạn!</span>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Đính kèm hình ảnh (nếu có)</label>
                                    <input type="file" class="form-control" id="contactImage" accept="image/*" onchange="previewContactImage(this)">
                                    <div class="form-text">Chấp nhận: JPG, PNG, GIF (tối đa 5MB)</div>
                                    <div id="contactImagePreview" class="mt-2"></div>
                                </div>

                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary btn-lg" id="contactSubmitBtn">
                                        <i class="fas fa-paper-plane"></i> Gửi tin nhắn
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body p-4">
                            <h4 class="card-title mb-4">Thông tin cửa hàng</h4>

                            <div class="mb-4">
                                <h6><i class="fas fa-clock text-primary"></i> Giờ làm việc</h6>
                                <p class="text-muted">
                                    Thứ 2 - Thứ 6: 8:00 - 20:00
                                </p>
                            </div>

                            <div class="mb-4">
                                <h6><i class="fas fa-question-circle text-primary"></i> Câu hỏi thường gặp</h6>
                                <ul class="list-unstyled text-muted">
                                    <li class="mb-2">• Chính sách bảo hành và đổi trả</li>
                                    <li class="mb-2">• Hướng dẫn thanh toán</li>
                                    <li class="mb-2">• Thời gian giao hàng</li>
                                    <li class="mb-2">• Chương trình khuyến mãi</li>
                                </ul>
                            </div>

                            <div class="mb-4">
                                <iframe
                                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d31434.005208326933!2d106.19561749306726!3d9.99614251696409!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31a012fe3c82bb95%3A0x501c872f365da2f6!2zdHQuIEPDoG5nIExvbmcsIEPDoG5nIExvbmcsIFRyw6AgVmluaCwgVmnhu4d0IE5hbQ!5e0!3m2!1svi!2s!4v1764856839069!5m2!1svi!2s"
                                    width="100%" height="300" style="border:0; border-radius: 1rem;" allowfullscreen=""
                                    loading="lazy"></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="footer-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
    <script src="js/components/header.js"></script>
    <script src="js/components/footer.js"></script>
    <script src="js/chatbot.js"></script>

    <script>
        // Load user info if logged in
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            
            if (token && userStr) {
                try {
                    const user = JSON.parse(userStr);
                    
                    // Fill user info
                    const nameInput = document.getElementById('contactName');
                    const emailInput = document.getElementById('contactEmail');
                    const phoneInput = document.getElementById('contactPhone');
                    
                    if (user.HoTen || user.hoTen) {
                        nameInput.value = user.HoTen || user.hoTen;
                        nameInput.readOnly = true;
                        nameInput.classList.add('bg-light');
                    }
                    
                    if (user.Email || user.email) {
                        emailInput.value = user.Email || user.email;
                        emailInput.readOnly = true;
                        emailInput.classList.add('bg-light');
                    }
                    
                    if (user.SoDienThoai || user.soDienThoai) {
                        phoneInput.value = user.SoDienThoai || user.soDienThoai;
                        phoneInput.readOnly = true;
                        phoneInput.classList.add('bg-light');
                    }
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
        });

        // Count words in textarea
        function countWords(textarea) {
            const text = textarea.value.trim();
            const words = text ? text.split(/\s+/).filter(word => word.length > 0) : [];
            const wordCount = words.length;
            
            document.getElementById('wordCount').textContent = wordCount;
            
            const warning = document.getElementById('wordCountWarning');
            const submitBtn = document.getElementById('contactSubmitBtn');
            
            if (wordCount > 100) {
                warning.style.display = 'inline';
                submitBtn.disabled = true;
                textarea.classList.add('is-invalid');
            } else {
                warning.style.display = 'none';
                submitBtn.disabled = false;
                textarea.classList.remove('is-invalid');
            }
        }

        function previewContactImage(input) {
            const preview = document.getElementById('contactImagePreview');
            preview.innerHTML = '';

            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // Check file size (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Kích thước ảnh không được vượt quá 5MB', 'error');
                    input.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" class="img-thumbnail" style="max-height: 150px">
                        <p class="text-muted small mt-1">${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)</p>
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        async function handleContact(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('contactSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang gửi...';

            try {
                const hoTen = document.getElementById('contactName').value.trim();
                const email = document.getElementById('contactEmail').value.trim();
                const soDienThoai = document.getElementById('contactPhone').value.trim();
                const tieuDe = document.getElementById('contactSubject').value;
                const noiDung = document.getElementById('contactMessage').value.trim();
                const imageFile = document.getElementById('contactImage').files[0];

                let hinhAnh = null;

                // Upload image if selected
                if (imageFile) {
                    const formData = new FormData();
                    formData.append('image', imageFile);

                    const uploadResult = await api.post('/upload/image', formData);
                    if (uploadResult.success) {
                        hinhAnh = uploadResult.data.url;
                    } else {
                        showNotification('Lỗi khi upload ảnh', 'error');
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Gửi tin nhắn';
                        return;
                    }
                }

                // Send contact
                const result = await api.post('/contact', {
                    hoTen,
                    email,
                    soDienThoai,
                    tieuDe,
                    noiDung,
                    hinhAnh
                });

                if (result.success) {
                    showNotification(result.message || 'Gửi liên hệ thành công!', 'success');
                    event.target.reset();
                    document.getElementById('contactImagePreview').innerHTML = '';
                } else {
                    showNotification(result.message || 'Gửi thất bại', 'error');
                }
            } catch (error) {
                console.error('Contact error:', error);
                showNotification('Lỗi khi gửi liên hệ', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Gửi tin nhắn';
            }
        }
    </script>

  <!-- Scroll to Top Button -->
  <script src="js/components/scroll-to-top.js"></script>
</body>

</html>