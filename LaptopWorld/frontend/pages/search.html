<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tìm kiếm - Laptop World</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <h3>Tìm kiếm sản phẩm</h3>
      <form id="search-form" class="mb-3">
        <div class="input-group">
          <input id="q" class="form-control" placeholder="Tìm tên sản phẩm">
          <button class="btn btn-primary">Tìm</button>
        <script>
          document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(location.search);
            const q0 = params.get('q') || '';
            const input = document.getElementById('q');
            if (input) input.value = q0;
            document.getElementById('search-form').addEventListener('submit', (e) => {
              e.preventDefault();
              const q = document.getElementById('q').value;
              location.search = '?q=' + encodeURIComponent(q);
            });
            // render results
            (async () => {
              const q = document.getElementById('q').value || '';
              const r = await fetch('/api/search?q=' + encodeURIComponent(q));
              const data = await r.json().catch(()=>({}));
              const out = document.getElementById('results');
              out.innerHTML = '';
              (data.results || []).forEach(p => {
                const div = document.createElement('div');
                div.className = 'col-md-4';
                div.innerHTML = `<div class="card p-2 mb-3"><h5>${p.TenSanPham}</h5><p>${formatCurrency(p.GiaSanPham) || ''}</p><a href="/pages/product.html?id=${p.IdSanPham}" class="btn btn-sm btn-outline-primary mt-2">Xem</a><button class="btn btn-sm btn-success mt-2" data-add='${JSON.stringify({ id: p.IdSanPham, name: p.TenSanPham, price: p.GiaSanPham })}'>Thêm vào giỏ</button></div>`;
                out.appendChild(div);
              });
              out.querySelectorAll('button[data-add]').forEach(btn=>btn.addEventListener('click', ()=>{const info=JSON.parse(btn.getAttribute('data-add')); addToCart(info.id,info.name,info.price); alert('Đã thêm vào giỏ');}));
            })();
          });
        </script>
          div.innerHTML = `<div class="card p-2 mb-3"><h5>${p.TenSanPham}</h5><p>${p.GiaSanPham || ''}</p></div>`;
          out.appendChild(div);
        });
      });
    </script>
  </body>
</html>
